<!-- app.component.html -->

<!-- Intro Screen -->
@if (currentScreen === 'intro') {
  <div id="intro-container">
    <div id="intro-screen">
      <img src="present.gif" alt="Cute animation" class="intro-gif">

      <h1>Ένα παιχνίδι ειδικά για εσένα!</h1>
      <p>Θέλεις να παίξεις;</p>
      
      <div class="button-container">
        <button id="yes-btn" (click)="startGame()">Ναι! Θέλω να παίξω</button>
        <button 
          id="no-btn" 
          [ngStyle]="noButtonStyle"
          (mouseenter)="moveNoButton()"
          (click)="moveNoButton()">
          Όχι! Δεν θέλω να παίξω
        </button>
      </div>
    </div>
  </div>
}

<!-- Game Screen -->
@if (currentScreen === 'game') {
  <div class="screen">
    <div id="game-screen">
      <div class="game-info">
        <h2>Βρες με!</h2>
        <p>Χρησιμοποίησε το WASD ή τα πλήκτρα βέλους για να κινηθείς</p>
        <p>Checkpoints που ολοκληρώθηκαν: {{ getCompletedCheckpointsCount() }}/{{ checkpoints.length }}</p>
      </div>
      
      <div class="maze-container">
        <!-- Maze Grid -->
        <div class="maze">
          @for (row of maze; track $index; let y = $index) {
            <div class="maze-row">
              @for (cell of row; track $index; let x = $index) {
                <div 
                  class="maze-cell"
                  [class.wall]="cell === 0"
                  [class.path]="cell === 1"
                  [class.checkpoint]="cell === 2"
                  [class.active]="cell === 2 && !isCheckpointCompleted(x, y)"
                  [style.width.px]="cellSize"
                  [style.height.px]="cellSize">
                  @if (cell === 2 && !isCheckpointCompleted(x, y)) {
                    <span>⭐</span>
                  }
                </div>
              }
            </div>
          }
          
          <!-- Player -->
          <div class="player" [ngStyle]="getPlayerStyle()">
            <img src="boyfriend-avatar.png" alt="Player" class="avatar">
          </div>
          <!-- Goal -->
          <div class="goal" [ngStyle]="getGoalStyle()">
            <img src="girlfriend-avatar.png" alt="Goal" class="avatar">
          </div>
        </div>
      </div>
    </div>
  </div>
}

<!-- Checkpoint Modal -->
@if (currentScreen === 'checkpoint') {
  <div class="screen">
    <div class="checkpoint-modal" [class.proverbs-modal]="currentCheckpoint?.type === 'proverbs'"
    [class.timeline-modal]="currentCheckpoint?.type === 'timeline'">
      <!-- Birthday Checkpoint -->
      @if (currentCheckpoint?.type === 'birthday') {
        <div>
          <h2>Checkpoint: Γενέθλια!</h2>
          <p>Συνήθιζες να το ξεχνάς... Πότε έχω γενέθλια;</p>
          
          <input 
            type="date" 
            [(ngModel)]="birthdayAnswer" 
            (keyup.enter)="checkBirthday()"
            class="date-input">

          @if (birthdayError) {
            <p class="error">{{ birthdayError }}</p>
          }
          <button (click)="checkBirthday()">Υποβολή</button>
        </div>
      }
            
      <!-- Find Item Checkpoint -->
      @if (currentCheckpoint?.type === 'find-item') {
        <div>
          <h2>Checkpoint: Βρες το αντικείμενο!</h2>
          <p>Βρες το αντικείμενο που πάντα ξεχνάς να φέρεις... και το θυμάσαι το πρωί!</p>
          <div class="find-item-grid">
            @for (item of findItems; track item) {
              <div (click)="checkFindItem(item)">
                {{ item }}
              </div>
            }
          </div>
          @if (findItemError) {
            <p class="error">{{ findItemError }}</p>
          }
        </div>
      }
      
      <!-- Song Checkpoint -->
      @if (currentCheckpoint?.type === 'song') {
        <div>
          <h2>Checkpoint: Ταινίες!</h2>
          <p>Ποιο είναι το </p>
          <input 
            type="text" 
            [(ngModel)]="songAnswer" 
            placeholder="Τίτλος ταινίας..."
            (keyup.enter)="checkSong()">
          @if (songError) {
            <p class="error">{{ songError }}</p>
          }
          <button (click)="checkSong()">Υποβολή</button>
        </div>
      }

      @if (currentCheckpoint?.type === 'proverbs') {
        <div class="checkpoint-modal proverbs-modal">
          <h2>Checkpoint: Οι παροιμίες σου</h2>
          <p>Συμπλήρωσε τις λέξεις που λείπουν:</p>

          <div class="proverbs-list">
            <p>1. Σαρανταπέντε Γιάννηδες ενός <input [(ngModel)]="proverbsAnswers.p1" class="small-input"> γνώση</p>
            <p>2. Όχι Γιάννης, <input [(ngModel)]="proverbsAnswers.p2" class="small-input"></p>
            <p>3. Γιάννης κερνάει και Γιάννης <input [(ngModel)]="proverbsAnswers.p3" class="small-input"></p>
            <p>4. Ακόμα δεν τον είδαμε, Γιάννη τον <input [(ngModel)]="proverbsAnswers.p4" class="small-input"></p>
            <p>5. Πότε ο Γιάννης δεν <input [(ngModel)]="proverbsAnswers.p5" class="small-input">, πότε ο κώλος του πονεί</p>
            <p>6. Φοβάται ο Γιάννης το <input [(ngModel)]="proverbsAnswers.p6" class="small-input"> και το θεριό τον Γιάννη</p>
            <p>7. Σπίτι χωρίς Γιάννη, <input [(ngModel)]="proverbsAnswers.p7" class="small-input"> δεν κάνει.</p>
          </div>

          @if (proverbsError) {
            <p class="error">{{ proverbsError }}</p>
          }

          <div class="hint-video">
            <p class="hint">💡 Χρειάζεσαι βοήθεια; Δες το βίντεο:</p>
            <iframe 
              width="560" 
              height="315" 
              src="https://www.youtube.com/embed/KzXhvDfiD_o?enablejsapi=1&origin=file://" 
              frameborder="0" 
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
              allowfullscreen>
            </iframe>
          </div>

          <button (click)="checkProverbs()">Επαλήθευση</button>
        </div>
      }

      @if (currentCheckpoint?.type === 'timeline') {
        <div class="checkpoint-modal timeline-modal">
          <h2>Checkpoint: Οι Αναμνήσεις μας</h2>
          <p>Βάλε τις στιγμές μας στη σωστή χρονολογική σειρά (1 το πιο παλιό, 6 το πιο πρόσφατο):</p>
          
          <div class="timeline-grid">
            <div class="timeline-item">
              <img src="us2.jpg" alt="Moment A">
              <input type="number" [(ngModel)]="timelineOrder.img1" placeholder="Σειρά">
            </div>
            <div class="timeline-item">
              <img src="us4.jpg" alt="Moment B">
              <input type="number" [(ngModel)]="timelineOrder.img2" placeholder="Σειρά">
            </div>
            <div class="timeline-item">
              <img src="us1.jpg" alt="Moment C">
              <input type="number" [(ngModel)]="timelineOrder.img3" placeholder="Σειρά">
            </div>
            <div class="timeline-item">
              <img src="us3.jpg" alt="Moment D">
              <input type="number" [(ngModel)]="timelineOrder.img4" placeholder="Σειρά">
            </div>
            <div class="timeline-item">
              <img src="us6.jpg" alt="Moment E">
              <input type="number" [(ngModel)]="timelineOrder.img5" placeholder="Σειρά">
            </div>
            <div class="timeline-item">
              <img src="us5.jpg" alt="Moment F">
              <input type="number" [(ngModel)]="timelineOrder.img6" placeholder="Σειρά">
            </div>
          </div>

          @if (timelineError) { <p class="error">{{ timelineError }}</p> }
          <button (click)="checkTimeline()">Έλεγχος σειράς</button>
        </div>
      }

      @if (currentCheckpoint?.type === 'emoji-quiz') {
        <div class="checkpoint-modal">
          <h2>Checkpoint: Το "Απαγορευμένο" Emoji</h2>
          <p>Ποιο emoji δεν ήθελες καθόλου να σου στέλνω;</p>
          
          <div class="emoji-options">
            <div class="emoji-btn" (click)="checkEmoji('🙄')">🙄</div>
            <div class="emoji-btn" (click)="checkEmoji('😏')">😏</div>
            <div class="emoji-btn" (click)="checkEmoji('🤡')">🤡</div>
            <div class="emoji-btn" (click)="checkEmoji('😒')">😒</div>
          </div>

          @if (emojiError) { <p class="error">{{ emojiError }}</p> }
        </div>
      }
    </div>
  </div>
}

<!-- Win Screen -->
@if (currentScreen === 'win') {
  <div class="screen">
    <div id="win-screen">
      <div class="heart">❤️</div>
      <h1>Συγχαρητήρια! Με βρήκες!</h1>
      <p>Χρόνια Πολλά αγάπη μου! Να χαίρεσαι το όνομά σου!</p>
      <p>Ο κωδικός είναι 030425. Ξέρεις τι είναι αυτό; Η επέτείος μας οπότε φρόντισε να το θυμάσαι!</p>
      <p class="message">Σ' ευχαριστώ που είσαι εσύ! Σ' αγαπώ!</p>
    </div>
  </div>
}